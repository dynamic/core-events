language: php
php:
 - 5.4

env:
  matrix:
   - DB=MYSQL CORE_RELEASE=3.1
   - DB=PGSQL CORE_RELEASE=3.1
   - DB=SQLITE CORE_RELEASE=3.1

matrix:
  allow_failures:
    - php: 7.0
    - env: DB=MYSQL CORE_RELEASE=3.2
    - env: DB=MYSQL CORE_RELEASE=master
  include:
    - php: 5.5
      env: DB=MYSQL CORE_RELEASE=3.1
    - php: 5.5
      env: DB=MYSQL CORE_RELEASE=3.2
    - php: 5.6
      env: DB=MYSQL CORE_RELEASE=3.1
    - php: 5.6
      env: DB=MYSQL CORE_RELEASE=3.2
    - php: 5.6
      env: DB=MYSQL CORE_RELEASE=master
    - php: 7.0
      env: DB=MYSQL CORE_RELEASE=3.2
    - php: 7.0
      env: DB=MYSQL CORE_RELEASE=master
before_script:
- phpenv rehash
- git clone git@github.com:dynamic/silverstripe-travis-support.git ~/travis-support
- php ~/travis-support/travis_setup.php --source `pwd` --target ~/builds/ss
- cd ~/builds/ss
script:
- vendor/bin/phpunit core-events/tests/
notifications:
  slack:
    secure: aqLIGtpDHzFZDjGc6GezykNQ/8PRGF13b3C22TT/EnfC97H1hBYoYl5VUB8Y7M6w9RubiVOR6r6sKkJ4wRLhm4TM3Z8UEe3dAxAM/dQYMiZ7CCie67p4NJkMYGz15Od3j2gOJoTLB1qGjardTlSTjF+JdoX5S9LYjfugUpSZP7c=
